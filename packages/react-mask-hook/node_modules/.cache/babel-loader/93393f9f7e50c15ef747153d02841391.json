{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useMemo } from 'react';\nimport useCallbackAfterRender from './useCallbackAfterRender';\nimport getMaskedValue from '../functions/getMaskedValue';\nimport getNextCursorPosition from '../functions/getNextCursorPosition';\nimport { getNumbersFromMaskedValue as getRawValuesFromMaskedValue } from '../functions/regexHelpers';\nimport useDebugMode from './useDebugMode';\nimport parseMask from '../functions/convertStringMaskToRegexp';\nimport getPlaceholderFromMask from '../functions/getPlaceholderFromMask';\n/**\n * \n * @param value \n * @param onChange \n * @param mask \n * @param displayMask \n */\n\nexport function useMask({\n  value = '',\n  onChange,\n  displayMask,\n  debug = false,\n  ...props\n}) {\n  _s();\n\n  const mask = useMemo(() => parseMask(props.mask), [props.mask]);\n  const placeholder = useMemo(() => getPlaceholderFromMask(mask, displayMask), [mask, displayMask]);\n  const maskedValue = getMaskedValue(value, mask, displayMask);\n  const nextCursorPosition = getNextCursorPosition(value, mask);\n  const scheduleAfterRender = useCallbackAfterRender();\n  useDebugMode(debug, {\n    mask,\n    displayMask,\n    value,\n    maskedValue\n  }); // Using an onChange instead of keyboard events because mobile devices don't fire key events\n\n  function handleChange({\n    target\n  }) {\n    const rawValues = getRawValuesFromMaskedValue(target.value, mask);\n    const newValue = target.value.length < placeholder.length // deleted a mask symbol\n    && rawValues.length >= value.length // a number was deleted so we don't need to remove another\n    ? rawValues.slice(0, rawValues.length - 1) // remove a character\n    : rawValues;\n    onChange(newValue); // onChange is asynchronous so update cursor after it re-renders\n\n    scheduleAfterRender(() => {\n      setCursorPositionForElement(target, getNextCursorPosition(newValue, mask));\n    });\n  } // For some reason, tests fail without this...\n  // TODO: Figure out why this is necessary\n\n\n  function onKeyUp({\n    target\n  }) {\n    setCursorPositionForElement(target, nextCursorPosition);\n  }\n\n  function onKeyDown({\n    target\n  }) {\n    // make sure cursor is positioned correctly before input happens\n    // or else the character might not be in the right position\n    setCursorPositionForElement(target, nextCursorPosition);\n  }\n\n  function onFocus({\n    target\n  }) {\n    // Work around in chrome to make sure focus sets cursor position\n    requestAnimationFrame(() => {\n      setCursorPositionForElement(target, getNextCursorPosition(target.value, mask));\n    });\n  }\n\n  return {\n    'data-value': value.length ? value : undefined,\n    value: value.length ? maskedValue : placeholder,\n    // render placeholder if they haven't entered anything\n    placeholder,\n    onChange: handleChange,\n    onKeyDown,\n    onKeyUp,\n    onFocus\n  };\n}\n\n_s(useMask, \"3G9VvikYqtAYFdgdBbJIDtRdMco=\", false, function () {\n  return [useCallbackAfterRender, useDebugMode];\n});\n\n/**\n * \n * @param element \n * @param cursorPosition \n */\nfunction setCursorPositionForElement(element, cursorPosition) {\n  element === null || element === void 0 ? void 0 : element.setSelectionRange(cursorPosition, cursorPosition, 'forward');\n}\n\nexport default useMask;","map":{"version":3,"sources":["/home/codespace/workspace/react-mask-hook/src/hooks/useMask.ts"],"names":["useMemo","useCallbackAfterRender","getMaskedValue","getNextCursorPosition","getNumbersFromMaskedValue","getRawValuesFromMaskedValue","useDebugMode","parseMask","getPlaceholderFromMask","useMask","value","onChange","displayMask","debug","props","mask","placeholder","maskedValue","nextCursorPosition","scheduleAfterRender","handleChange","target","rawValues","newValue","length","slice","setCursorPositionForElement","onKeyUp","onKeyDown","onFocus","requestAnimationFrame","undefined","element","cursorPosition","setSelectionRange"],"mappings":"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","sourcesContent":["import { KeyboardEvent, ChangeEvent, FocusEvent, useMemo, } from 'react'\n\nimport useCallbackAfterRender from './useCallbackAfterRender'\nimport getMaskedValue from '../functions/getMaskedValue'\nimport getNextCursorPosition from '../functions/getNextCursorPosition'\n\nimport { getNumbersFromMaskedValue as getRawValuesFromMaskedValue } from '../functions/regexHelpers'\nimport useDebugMode from './useDebugMode'\nimport parseMask from '../functions/convertStringMaskToRegexp'\nimport getPlaceholderFromMask from '../functions/getPlaceholderFromMask'\n\n/**\n * \n * @param value \n * @param onChange \n * @param mask \n * @param displayMask \n */\nexport function useMask({\n    value = '',\n    onChange,\n    displayMask,\n    debug = false,\n    ...props\n}: MaskProps) {\n    const mask = useMemo(() => parseMask(props.mask), [ props.mask ])\n    const placeholder = useMemo(() => getPlaceholderFromMask(mask, displayMask), [ mask, displayMask ])\n\n    const maskedValue = getMaskedValue(value, mask, displayMask)\n    const nextCursorPosition = getNextCursorPosition(value, mask)\n    const scheduleAfterRender = useCallbackAfterRender()\n\n    useDebugMode(debug, {\n        mask,\n        displayMask,\n        value,\n        maskedValue,\n    })\n\n    // Using an onChange instead of keyboard events because mobile devices don't fire key events\n    function handleChange({ target }: ChangeEvent<HTMLInputElement>) {\n        const rawValues = getRawValuesFromMaskedValue(target.value, mask)\n        \n        const newValue = (\n            target.value.length < placeholder.length // deleted a mask symbol\n            && rawValues.length >= value.length // a number was deleted so we don't need to remove another\n        )\n            ? rawValues.slice(0, rawValues.length - 1) // remove a character\n            : rawValues\n\n        onChange(newValue)\n\n        // onChange is asynchronous so update cursor after it re-renders\n        scheduleAfterRender(() => {\n            setCursorPositionForElement(target, getNextCursorPosition(newValue, mask))\n        })\n    }\n\n    // For some reason, tests fail without this...\n    // TODO: Figure out why this is necessary\n    function onKeyUp({ target }: KeyboardEvent<HTMLInputElement>) {\n        setCursorPositionForElement(target as HTMLInputElement, nextCursorPosition)\n    }\n\n    function onKeyDown({ target}: KeyboardEvent<HTMLInputElement>) {\n        // make sure cursor is positioned correctly before input happens\n        // or else the character might not be in the right position\n        setCursorPositionForElement(target as HTMLInputElement, nextCursorPosition)\n    }\n\n    function onFocus({ target }: FocusEvent<HTMLInputElement>) {\n        // Work around in chrome to make sure focus sets cursor position\n        requestAnimationFrame(() => {\n            setCursorPositionForElement(target as HTMLInputElement, getNextCursorPosition(target.value, mask))\n        })\n    }\n\n    return {\n        'data-value': value.length ? value: undefined,\n        value: value.length ? maskedValue : placeholder, // render placeholder if they haven't entered anything\n        placeholder,\n\n        onChange: handleChange,\n        onKeyDown,\n        onKeyUp,\n        onFocus,\n    }\n}\n\ninterface MaskProps {\n    value: string\n    onChange: (value: string) => void\n    mask: string | Mask\n    displayMask: string\n    debug?: boolean\n}\n\ntype Mask = Array<string | RegExp>\n\n/**\n * \n * @param element \n * @param cursorPosition \n */\nfunction setCursorPositionForElement(element: HTMLInputElement, cursorPosition: number): void {\n    element?.setSelectionRange(cursorPosition, cursorPosition, 'forward')\n}\n\nexport default useMask\nexport type {\n    MaskProps,\n    Mask,\n}"]},"metadata":{},"sourceType":"module"}